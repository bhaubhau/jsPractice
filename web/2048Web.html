<!DOCTYPE html>
<html>

<head>
	<title>2048</title>
	<style>
		td.tile {
			border: 1px solid black;
			width: 70px;
			height: 70px;
		}

		i {
			border: solid black;
			border-width: 0 3px 3px 0;
			display: inline-block;
			padding: 3px;
		}

		.right {
			transform: rotate(-45deg);
			-webkit-transform: rotate(-45deg);
		}

		.left {
			transform: rotate(135deg);
			-webkit-transform: rotate(135deg);
		}

		.up {
			transform: rotate(-135deg);
			-webkit-transform: rotate(-135deg);
		}

		.down {
			transform: rotate(45deg);
			-webkit-transform: rotate(45deg);
		}
	</style>
</head>

<body onload="init()">
	<h1 style="text-align: center">2048</h1>
	<table style="margin-left: auto; margin-right: auto; text-align: center">
		<tr>
			<td></td>
			<td>
				<button type="button" onclick="buttonClicked()">
					<i class="up"></i>
				</button>
			</td>
			<td></td>
		</tr>
		<tr>
			<td>
				<button type="button" onclick="buttonClicked()">
					<i class="left"></i>
				</button>
			</td>
			<td>
				<table>
					<tr>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
					</tr>
					<tr>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
					</tr>
					<tr>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
					</tr>
					<tr>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
						<td class="tile"></td>
					</tr>
				</table>
			</td>
			<td>
				<button type="button" onclick="buttonClicked()">
					<i class="right"></i>
				</button>
			</td>
		</tr>
		<tr>
			<td></td>
			<td>
				<button type="button" onclick="buttonClicked()">
					<i class="down"></i>
				</button>
			</td>
			<td></td>
		</tr>
	</table>
	<script>
		var currentTileValues = [];
		var rows = 4;
		var columns = 4;

		function init() {
			let initialInsertionMatrix = [];
			for (let rowIndex = 0; rowIndex < rows; rowIndex++) {
				rowValues = [];
				rowValuesInitialInsertionMatrix = [];
				for (let columnIndex = 0; columnIndex < columns; columnIndex++) {
					rowValues.push(0);
					rowValuesInitialInsertionMatrix.push(2);
				}
				currentTileValues.push(rowValues);
				initialInsertionMatrix.push(rowValuesInitialInsertionMatrix);
			}
			insertTile(initialInsertionMatrix);
			insertTile(initialInsertionMatrix);
			updateDisplayedTiles();
		}

		function updateDisplayedTiles() {
			let tileElements = Array.from(document.getElementsByClassName("tile"));
			tileElements.forEach(function (tileElement, index) {
				let rowIndex = Math.floor(index / columns);
				let columnIndex = index % columns;
				let value = currentTileValues[rowIndex][columnIndex];
				if (value != 0) {
					tileElement.innerHTML = value;
				} else {
					tileElement.innerHTML = "";
				}
			});
		}

		function getRandomInteger(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		function shuffle(arrayValues) {
			values = [];
			while (arrayValues.length > 0) {
				removeIndex = getRandomInteger(1, arrayValues.length) - 1;
				values.push(arrayValues.splice(removeIndex, 1)[0]);
			}
			return values;
		}

		function generateInsertionMatrix() {
			/*
			Below two parameters are used to generate one value which is doubled than the least value at random times 
			so as to increase the complexity of game
			*/
			doubledTileMinIndex = 30;
			doubledTileMaxIndex = 50;
			minInsertionValue = 2;
			doubledTileIndex = getRandomInteger(doubledTileMinIndex, doubledTileMaxIndex);
			let values = [];
			for (let index = 0; index < doubledTileIndex; index++) {
				values.push(minInsertionValue);
			}
			values.push(minInsertionValue * 2);
			values = shuffle(values);
			let insertionValues = values.slice(0, 16);
			values = [];
			for (let rowIndex = 0; rowIndex < rows; rowIndex++) {
				rowValues = [];
				for (let columnIndex = 0; columnIndex < columns; columnIndex++) {
					rowValues.push(insertionValues[(rowIndex * columns) + columnIndex]);
				}
				values.push(rowValues);
			}
			return values;
		}

		function insertTile(insertionMatrix) {
			let blankIndices = [];
			for (let rowIndex = 0; rowIndex < rows; rowIndex++) {
				for (let columnIndex = 0; columnIndex < columns; columnIndex++) {
					if (currentTileValues[rowIndex][columnIndex] == 0) {
						blankIndex = [rowIndex, columnIndex];
						blankIndices.push(blankIndex);
					}
				}
			}
			insertionIndex = blankIndices[getRandomInteger(1, blankIndices.length) - 1];
			currentTileValues[insertionIndex[0]][insertionIndex[1]] = insertionMatrix[insertionIndex[0]][insertionIndex[1]];
		}

		function buttonClicked() {
			insertTile(generateInsertionMatrix());
			updateDisplayedTiles();
		}
	</script>
</body>

</html>